# Telegram-бот для учета калорий

## Описание

Этот Telegram-бот предназначен для отслеживания ежедневного потребления калорий. Он позволяет:

- Записывать съеденные продукты, их вес и автоматически рассчитывать потребленные калории.
- Искать информацию о калорийности продуктов через API Open Food Facts.
- Сохранять личный список продуктов пользователя для быстрого ввода.

Также реализована система пользовательских настроек:

- Установка часового пояса для корректных отчетов.
- Расчет дневной нормы калорий на основе данных профиля (вес, рост, пол) и выбранной цели (дефицит, поддержание, профицит) с использованием формул расчета сухой массы тела (LBM).

## Основные возможности

- **Добавление записей о приемах пищи**: продукт, вес.
- **Автоматический поиск калорийности** для новых продуктов через API Open Food Facts.
- **Подтверждение/редактирование калорийности**, найденной через API.
- **Контекстные подсказки** при вводе названия продукта из личного списка.
- **Расчет дневной нормы калорий** на основе LBM, пола и цели пользователя.
- **Ежедневная сводка** (`/today`) с отображением потребленных калорий, нормы и мотивационным сообщением.
- **Отчеты за неделю** (`/week`) и **месяц** (`/month`) с общей и среднесуточной калорийностью.
- **Настройка профиля пользователя** (`/settings`): установка цели, пола, роста, веса.
- **Быстрое обновление веса** (`/setweight`).
- **Развертывание с использованием Docker и Docker Compose**.
- **Редактирование и удаление продуктов**: через меню "Настройки" → "Редактирование продуктов" можно просматривать, редактировать (название и калорийность) и удалять продукты из личного списка. Реализована постраничная навигация и удобное подменю для каждого продукта.

## Технологический стек

- **Язык**: Python 3.12+
- **Библиотека для Telegram**: Aiogram 3.x
- **База данных**: PostgreSQL 15+
- **Драйвер БД**: asyncpg
- **Работа с HTTP**: aiohttp (для API Open Food Facts)
- **Работа с часовыми поясами**: pytz
- **Контейнеризация**: Docker, Docker Compose
- **Зависимости**: python-dotenv

## Установка и запуск

### Требования

- Python (версия 3.10 или выше)
- Docker
- Docker Compose
- PostgreSQL сервер (может быть запущен локально или в Docker)

### Локальный запуск (для разработки)

1. **Клонировать репозиторий**:

   ```bash
   git clone <URL вашего репозитория>
   cd <папка проекта>
   ```

2. **Создать и активировать виртуальное окружение**:

   ```bash
   python -m venv venv
   # Windows:
   venv\Scripts\activate
   # macOS/Linux:
   source venv/bin/activate
   ```

3. **Установить зависимости**:

   ```bash
   pip install -r requirements.txt
   ```

4. **Настроить базу данных PostgreSQL**:

   - Установить PostgreSQL, если не установлен.
   - Создать базу данных (например, `meal_taken_bot_db`).
   - Создать пользователя и выдать ему права на эту базу.
   - Установить расширение `pg_trgm`:

     ```sql
     CREATE EXTENSION IF NOT EXISTS pg_trgm;
     ```

5. **Создать файл `.env`**:

   - Скопируй `.env.example` (если есть) или создай файл `.env` вручную в корне проекта.
   - Заполни необходимые переменные:

     ```env
     BOT_TOKEN=ВАШ_ТЕЛЕГРАМ_ТОКЕН
     DB_USER=пользователь_бд
     DB_PASS=пароль_бд
     DB_HOST=localhost # Или адрес вашего сервера БД
     DB_PORT=5432 # Или другой порт
     DB_NAME=имя_бд # Например, meal_taken_bot_db
     ```

6. **Запустить бота**:

   ```bash
   python main.py
   ```

### Запуск с Docker Compose (рекомендуется для VPS)

1. **Клонировать репозиторий на сервер**:

   ```bash
   git clone <URL вашего репозитория>
   cd <папка проекта>
   ```

2. **Создать файл `.env` в корне проекта на сервере**:

   - Заполни `BOT_TOKEN`, `DB_USER`, `DB_PASS`, `DB_NAME`.
   - Установи `DB_HOST=db` (имя сервиса БД из `docker-compose.yml`).
   - Установи `DB_PORT=5432`.

3. **Запустить контейнеры**:

   ```bash
   docker compose up -d --build
   ```

   > Флаг `--build` нужен при первом запуске и после изменений в коде или `Dockerfile`.

4. **Установить расширение `pg_trgm` (только при первом запуске базы данных)**:

   ```bash
   docker compose exec db psql -U ${DB_USER} -d ${DB_NAME} -c "CREATE EXTENSION IF NOT EXISTS pg_trgm;"
   ```

5. **Просмотр логов**:

   ```bash
   docker compose logs -f bot # Логи бота
   docker compose logs -f db  # Логи базы данных
   ```

6. **Остановка**:

   ```bash
   docker compose down
   ```

## Использование

### Основные команды

- `/start` - Запуск бота, приветствие.
- `/add` (или кнопка "➕ Добавить продукт") - Начать процесс добавления съеденного продукта.
- `/today` - Показать сводку за текущий день (потребленные калории, список продуктов, дневная норма, мотивация).
- `/week` - Отчет за последние 7 дней (общая и среднесуточная калорийность, сравнение с нормой).
- `/month` - Отчет за текущий месяц (общая и среднесуточная калорийность, сравнение с нормой).
- `/settings` - Открыть меню настроек профиля (цель, пол, рост, вес).
- `/setweight` - Быстро обновить текущий вес.
- `/timezone` - Установить часовой пояс.
- `/cancel` - Отменить текущее действие (например, добавление продукта или настройку).
- `/help` - Показать справку по командам.

## Планы на будущее

- Редактирование и удаление записей о приемах пищи.
- Более детальные отчеты (например, с графиками).
- Учет физической активности (возможно, интеграция с фитнес-трекерами?).
- Добавление библиотеки продуктов по умолчанию.
